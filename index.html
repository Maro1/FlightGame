<!DOCTYPE html>
<html>

<head>
    <title>Lighting</title>
    <style type="text/css">
        canvas {
            border: 1px solid gray;
        }
    </style>
</head>

<body>
    <canvas id="main_canvas"></canvas>

    <script id="vertex-shader" type="x-shader/x-vertex">
            precision mediump float;

            attribute vec3 a_Pos;
            attribute vec3 a_Normal;
            attribute vec2 a_TexCoord;

            varying vec3 v_Normal;
            varying vec3 v_FragPos;
            varying vec2 v_TexCoord;

            uniform mat4 model;
            uniform mat4 view;
            uniform mat4 proj;

            uniform mat4 transInvModel;

            void main() 
            {
                v_Normal = mat3(transInvModel) * a_Normal; 
                v_FragPos = vec3(model * vec4(a_Pos, 1.0));
                v_TexCoord = a_TexCoord;

                gl_Position = proj * view * model * vec4(a_Pos, 1.0); 
            }
        </script>
    <script id="fragment-shader" type="x-shader/x-fragment">
            precision mediump float;

            varying vec3 v_Normal;
            varying vec3 v_FragPos;
            varying vec2 v_TexCoord;

            uniform sampler2D diffuseMap;
            uniform sampler2D specularMap;

            uniform samplerCube skybox;

            uniform vec3 viewPos;

            uniform vec3 lightDir; 

            void main() {
                vec3 normal = normalize(v_Normal);

                vec3 kD = texture2D(diffuseMap, v_TexCoord).rgb;
                vec3 kS = texture2D(specularMap, v_TexCoord).rgb;

                vec3 ambient = kD * 0.3;

                vec3 diffuse = kD * max(dot(lightDir, normal), 0.0);

                vec3 viewDir = normalize(v_FragPos - viewPos);
                vec3 reflectDir = reflect(viewDir, normal);

                vec3 specular = kS * textureCube(skybox, reflectDir).rgb * pow(max(dot(viewDir, reflectDir), 0.0), 32.0);;

                gl_FragColor = vec4(ambient + diffuse + specular, 1.0);
            }
        </script>
    <script id="light-shader" type="x-shader/x-fragment">
            void main() 
            { 
                gl_FragColor = vec4(1.0); 
            }
        </script>
    <script id="skybox-vs" type="x-shader/x-vertex">
            attribute vec3 vPosition;
            varying vec4 fPosition;

            void main() {
                fPosition = vec4(vPosition, 1.0);
                gl_Position = vec4(vPosition, 1.0);
            }
        </script>
    <script id="skybox-fs" type="x-shader/x-fragment">
            precision mediump float;

            uniform samplerCube skybox;
            uniform mat4 viewProjInv;

            varying vec4 fPosition;

            void main() 
            {
                vec4 t = viewProjInv * fPosition;
                gl_FragColor = textureCube(skybox, normalize(t.xyz / t.w));
            }
        </script>
    <script type="text/javascript" src="resources/mesh_utils.js"></script>
    <script type="text/javascript" src="resources/glm_utils.js"></script>
    <script type="text/javascript" src="resources/webgl-utils.js"></script>
    <script type="text/javascript" src="resources/m4.js"></script>
    <script type="text/javascript" src="resources/jquery-3.6.0.js"></script>
    <script type="text/javascript" src="resources/dat.gui.js"></script>

    <script type="text/javascript" src="texture.js"></script>
    <script type="text/javascript" src="mesh.js"></script>
    <script type="text/javascript" src="camera.js"></script>
    <script type="text/javascript" src="airplane.js"></script>
    <script type="text/javascript" src="scene.js"></script>
    <script type="text/javascript" src="gui.js"></script>
    <script type="text/javascript" src="main.js"></script>
</body>

</html>