<!DOCTYPE html>
<html>

<head>
    <title>Lighting</title>
    <style type="text/css">
        canvas {
            border: 1px solid gray;
        }
    </style>
</head>

<body>
    <canvas id="main_canvas"></canvas>

    <script id="vertex-shader" type="x-shader/x-vertex">
            precision mediump float;

            attribute vec3 vPos;
            attribute vec3 vNormal;
            attribute vec2 vTexCoord;

            varying vec3 fNormal;
            varying vec3 fPos;
            varying vec2 fTexCoord;

            uniform mat4 model;
            uniform mat4 view;
            uniform mat4 proj;

            uniform mat4 transInvModel;

            void main() 
            {
                fNormal = mat3(transInvModel) * vNormal; 
                fPos = vec3(model * vec4(vPos, 1.0));
                fTexCoord = vTexCoord;

                gl_Position = proj * view * model * vec4(vPos, 1.0); 
            }
        </script>
    <script id="fragment-shader" type="x-shader/x-fragment">
            precision mediump float;

            varying vec3 fNormal;
            varying vec3 fPos;
            varying vec2 fTexCoord;

            uniform sampler2D diffuseMap;
            uniform sampler2D specularMap;

            uniform vec3 viewPos;

            uniform vec3 lightPos; 
            const vec3 kS = vec3(1.0, 1.0, 1.0);

            void main() 
            { 
                vec3 normal = normalize(fNormal);
                vec3 kD = texture2D(diffuseMap, fTexCoord).rgb;
                vec3 kS = texture2D(specularMap, fTexCoord).rgb;

                vec3 lightDir = normalize(lightPos - fPos);
                vec3 viewDir = normalize(viewPos - fPos);

                vec3 reflectDir = reflect(lightDir, normal);  
                vec3 specular = kS * pow(max(dot(viewDir, reflectDir), 0.0), 32.0);

                vec3 diffuse = kD * max(dot(lightDir, normal), 0.0);
                vec3 ambient = kD * 0.1; 

                gl_FragColor = vec4(ambient + diffuse + specular, 1.0); 
            }
        </script>
    <script id="light-shader" type="x-shader/x-fragment">
            void main() 
            { 
                gl_FragColor = vec4(1.0); 
            }
        </script>
    <script type="text/javascript" src="resources/mesh_utils.js"></script>
    <script type="text/javascript" src="resources/glm_utils.js"></script>
    <script type="text/javascript" src="resources/webgl-utils.js"></script>
    <script type="text/javascript" src="resources/m4.js"></script>
    <script type="text/javascript" src="resources/jquery-3.6.0.js"></script>
    <script type="text/javascript" src="load_mesh.js"></script>
    <script type="text/javascript" src="mesh.js"></script>
    <script type="text/javascript" src="camera.js"></script>
    <script type="text/javascript" src="light.js"></script>
    <script type="text/javascript" src="airplane.js"></script>
    <script type="text/javascript" src="main.js"></script>
</body>

</html>